{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://omen.ace-framework.org/schema/v0.7/header/PacketHeader.schema.json",
  "title": "PacketHeader",
  "description": "Identity, routing, and correlation fields required for every packet (OMEN.md Section 9.1, Lines 678-684)",
  "type": "object",
  "required": [
    "packet_id",
    "packet_type",
    "created_at",
    "layer_source",
    "correlation_id"
  ],
  "properties": {
    "packet_id": {
      "type": "string",
      "description": "Unique identifier for this packet",
      "pattern": "^pkt_[a-zA-Z0-9_-]+$",
      "examples": ["pkt_0123", "pkt_abc_456"]
    },
    "packet_type": {
      "type": "string",
      "description": "Type of packet (OMEN.md Section 9.3, Lines 756-763)",
      "enum": [
        "ObservationPacket",
        "BeliefUpdatePacket",
        "DecisionPacket",
        "VerificationPlanPacket",
        "ToolAuthorizationToken",
        "TaskDirectivePacket",
        "TaskResultPacket",
        "EscalationPacket",
        "IntegrityAlertPacket",
        "QueueUpdatePacket"
      ]
    },
    "created_at": {
      "type": "string",
      "description": "ISO 8601 timestamp of packet creation",
      "format": "date-time",
      "examples": ["2025-12-21T11:32:00-05:00"]
    },
    "layer_source": {
      "description": "ACE layer or overlay that generated this packet",
      "oneOf": [
        {
          "type": "integer",
          "minimum": 1,
          "maximum": 6
        },
        {
          "type": "string",
          "enum": ["Integrity"]
        }
      ],
      "examples": [1, 5, "Integrity"]
    },
    "correlation_id": {
      "type": "string",
      "description": "Episode identifier (all packets in an episode share this)",
      "pattern": "^corr_[a-zA-Z0-9_-]+$",
      "examples": ["corr_77A", "corr_verify_001"]
    },
    "campaign_id": {
      "type": "string",
      "description": "Optional macro context grouping multiple episodes",
      "pattern": "^camp_[a-zA-Z0-9_-]+$",
      "examples": ["camp_OMEN_BOOT", "camp_mining_q4"]
    },
    "previous_packet_id": {
      "type": "string",
      "description": "Optional reference to prior packet for explicit chaining",
      "pattern": "^pkt_[a-zA-Z0-9_-]+$",
      "examples": ["pkt_0122"]
    }
  },
  "additionalProperties": false
}
