{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://omen.ace-framework.org/schema/v0.7/packets/EscalationPacket.schema.json",
  "title": "EscalationPacket",
  "description": "Request for human decision or Layer 1 override when uncertainty/stakes exceed autonomy envelope (OMEN.md Section 9.3)",
  "allOf": [
    {
      "$ref": "./PacketBase.schema.json"
    }
  ],
  "properties": {
    "header": {
      "properties": {
        "packet_type": {
          "const": "EscalationPacket"
        }
      }
    },
    "payload": {
      "type": "object",
      "required": [
        "escalation_trigger",
        "top_options",
        "evidence_gaps",
        "recommended_next_step"
      ],
      "properties": {
        "escalation_trigger": {
          "type": "string",
          "description": "Why escalation was necessary",
          "enum": [
            "high_stakes_high_uncertainty",
            "constitutional_boundary",
            "contradiction_unresolved",
            "budget_insufficient",
            "tools_degraded_critical",
            "user_override_required"
          ]
        },
        "top_options": {
          "type": "array",
          "description": "2-3 candidate actions for human selection (OMEN.md Line 535)",
          "items": {
            "type": "object",
            "required": ["option_id", "description", "pros", "cons"],
            "properties": {
              "option_id": {"type": "string"},
              "description": {"type": "string"},
              "pros": {
                "type": "array",
                "items": {"type": "string"}
              },
              "cons": {
                "type": "array",
                "items": {"type": "string"}
              },
              "risk_summary": {"type": "string"}
            }
          },
          "minItems": 2,
          "maxItems": 3
        },
        "evidence_gaps": {
          "type": "array",
          "description": "Missing information preventing autonomous decision",
          "items": {
            "type": "object",
            "required": ["gap", "impact_if_unknown"],
            "properties": {
              "gap": {"type": "string"},
              "impact_if_unknown": {"type": "string"},
              "verification_method": {"type": "string"}
            }
          },
          "minItems": 1
        },
        "recommended_next_step": {
          "type": "object",
          "description": "OMEN's preferred verification or action path",
          "required": ["step", "rationale"],
          "properties": {
            "step": {"type": "string"},
            "rationale": {"type": "string"},
            "estimated_cost": {
              "type": "object",
              "properties": {
                "time_seconds": {"type": "integer"},
                "tokens": {"type": "integer"},
                "tool_calls": {"type": "integer"}
              }
            }
          }
        },
        "blocking_decision_packet_id": {
          "type": "string",
          "description": "DecisionPacket that triggered escalation",
          "pattern": "^pkt_[a-zA-Z0-9_-]+$"
        }
      },
      "additionalProperties": false
    }
  }
}
