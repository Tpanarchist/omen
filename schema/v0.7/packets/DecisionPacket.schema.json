{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://omen.ace-framework.org/schema/v0.7/packets/DecisionPacket.schema.json",
  "title": "DecisionPacket",
  "description": "Layer 5 decision output: chosen action, rejected alternatives, constraints fit (OMEN.md Section 9.3)",
  "allOf": [
    {
      "$ref": "./PacketBase.schema.json"
    }
  ],
  "properties": {
    "header": {
      "properties": {
        "packet_type": {
          "const": "DecisionPacket"
        }
      }
    },
    "payload": {
      "type": "object",
      "required": ["decision_outcome", "decision_summary", "constraints_satisfied"],
      "properties": {
        "decision_outcome": {
          "type": "string",
          "description": "Primary decision result",
          "enum": [
            "VERIFY_FIRST",
            "ACT",
            "ESCALATE",
            "DEFER",
            "CANCEL"
          ]
        },
        "decision_summary": {
          "type": "string",
          "description": "Human-readable rationale",
          "minLength": 1
        },
        "chosen_option": {
          "type": "object",
          "description": "Selected action or plan details",
          "properties": {
            "option_id": {"type": "string"},
            "description": {"type": "string"},
            "expected_value": {"type": "number"},
            "risk_profile": {"type": "string"}
          }
        },
        "rejected_alternatives": {
          "type": "array",
          "description": "Alternatives considered but not chosen",
          "items": {
            "type": "object",
            "properties": {
              "option_id": {"type": "string"},
              "rejection_reason": {"type": "string"}
            }
          }
        },
        "constraints_satisfied": {
          "type": "object",
          "description": "Verification that decision fits policy constraints",
          "required": ["constitutional_check", "budget_check", "tier_check"],
          "properties": {
            "constitutional_check": {
              "type": "boolean",
              "description": "Layer 1 veto passed"
            },
            "budget_check": {
              "type": "boolean",
              "description": "Feasible within budget envelope"
            },
            "tier_check": {
              "type": "boolean",
              "description": "Quality tier sufficient for stakes"
            },
            "verification_check": {
              "type": "boolean",
              "description": "Required verification level met"
            }
          }
        },
        "load_bearing_assumptions": {
          "type": "array",
          "description": "Assumptions that if false would flip decision",
          "items": {
            "type": "object",
            "required": ["assumption", "verified"],
            "properties": {
              "assumption": {"type": "string"},
              "verified": {"type": "boolean"},
              "verification_packet_id": {"type": "string"}
            }
          }
        },
        "failure_modes": {
          "type": "array",
          "description": "Known risks and mitigations",
          "items": {
            "type": "object",
            "properties": {
              "mode": {"type": "string"},
              "mitigation": {"type": "string"}
            }
          }
        }
      },
      "additionalProperties": false
    }
  }
}
